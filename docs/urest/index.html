<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>urest API documentation</title>
<meta name="description" content="Micro REST-Style API Server …" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Package <code>urest</code></h1>
</header>
<section id="section-intro">
<p>Micro REST-Style API Server.</p>
<h2 id="background">Background</h2>
<p>This library is designed to enable simple API's to be built on
micro-controllers, based on a sub-set of the REST API design principles, and
inspired by the design of the <a href="https://history-computer.com/apollo-guidance-computer/">Apollo
DSKY</a> guidance computer.
Rather than build a full HTTP server stack, including JSON parser, and
supporting the full complexity of modern REST API's, this library aims to
support simple operations in a resource constrained environment.</p>
<p>Like the DSKY unit, it is assumed that all the 'objects' representing the states
we are interested in are held in 'nouns' (implemented by the
<code><a title="urest.api.base.APIBase" href="api/base.html#urest.api.base.APIBase">APIBase</a></code> class). The HTTP actions then represent 'verbs' which
dictate the actions on the noun. So each API call is then in the form of
'verb-noun'; e.g. 'GET /led', or 'PUT /led'. Valid verb actions are</p>
<table>
<thead>
<tr>
<th>Verb</th>
<th>HTTP Method</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>Get</td>
<td><code>GET</code></td>
<td>Return the current state of the requested noun.</td>
</tr>
<tr>
<td>Set</td>
<td><code>PUT</code></td>
<td>Set the requested noun to <em>exactly</em> the specified state. This is assumed to be idempotent, with the resultant state matching exactly the request from the client.</td>
</tr>
<tr>
<td>Update</td>
<td><code>POST</code></td>
<td>Update the state requested noun. This is <em>not</em> assumed to be idempotent: for instance asking a noun to move between two states on each update.</td>
</tr>
<tr>
<td>Delete</td>
<td><code>DELETE</code></td>
<td>Remove the current state of the noun, and return to a the default state. This does <em>not</em> remove the noun from the API: only the state currently held by the API.</td>
</tr>
</tbody>
</table>
<p>In all cases the body of the HTTP request is a simple collection of 'key: value'
pairs, formatted as a <a href="https://www.json.org/json-en.html">JSON</a> object. Only a
sub-set of the JSON specification is used: in particular multiple objects are
not allowed, and nor are arrays (i.e. '<code>[]</code>') of any sort. This both simplifies
the parsing, and especially the memory required for the parser, and reinforces
the intent to support only minimal API's.</p>
<h2 id="design">Design</h2>
<p>The core of the library is a simple HTTP server, specialised to the delivery of
a REST-like API instead of a general HTTP server. The design, and the use of the
<code>asyncio</code> library, is inspired by the <a href="https://github.com/erikdelange/MicroPython-HTTP-Server">MicroPython HTTP
Server</a> by Erik de
Lange. This library uses a roughly similar structure for the core of the
<code>asyncio</code> event loop, and especially in the design of the
<code><a title="urest.http.server.RESTServer" href="http/server.html#urest.http.server.RESTServer">RESTServer</a></code> class.</p>
<p>Key differences include</p>
<ul>
<li>
<p>Support for <code>PUT</code>, <code>POST</code> and <code>DELETE</code> operations, in addition to <code>GET</code>.
These are required for an API server, and also form the 'verbs' of the actions
allowed on the 'nouns' by the API built on-top of this library.</p>
</li>
<li>
<p>A more object-oriented design of the call/response handler, made easier this
library is <em>not</em> a general HTTP server. For instance Python <code>getters</code> and
<code>setters</code> are used where possible for input validation, and the central API
response is based on the <code><a title="urest.api.base.APIBase" href="api/base.html#urest.api.base.APIBase">APIBase</a></code> abstract base class</p>
</li>
<li>
<p>A more explicit validation of input from the network layer, especially in
the assumption that all input is by default hostile. This library should serve
as an example of best-practice in protocol handling; at least in the slightly
resource constrained environment of MicroPython</p>
</li>
<li>
<p>This implementation is principally a teaching library, so the
<a href="https://dlove24.github.io/urest/urest">Documentation</a> should be at least as
important as the 'code'. Where possible all algorithms and implementation
techniques should also be explained as fully as possible, or at least linked to
reference standards/implementations</p>
</li>
<li>
<p>For consistency, all code should also be in the format standardised by the
<a href="https://github.com/psf/black">Black</a> library. This makes it easier to
co-ordinate external code and documentation with the implementation documented
here.</p>
</li>
</ul>
<h2 id="example">Example</h2>
<h3 id="creating-the-application-main-loop">Creating the Application <code>main</code> loop</h3>
<p>This module assumes that the lower-level networking layers are already in place:
if you are using MicroPython that may mean additional work. You will also need a
copy of the <code>asyncio</code> library (or <code>uasyncio</code> in MicroPython. This can be
imported conditionally as</p>
<pre><code class="language-python">   # Import the Asynchronous IO Library,
   # preferring the MicroPython library if
   # available
   try:
     import uasyncio as asyncio
   except ImportError:
    import asyncio
</code></pre>
<p>Once the network and asynchronous I/O library is available, create an instance
of the <code><a title="urest.http.server.RESTServer" href="http/server.html#urest.http.server.RESTServer">RESTServer</a></code> class from the <code><a title="urest.http.server" href="http/server.html">urest.http.server</a></code> module</p>
<pre><code class="language-python">  from urest.http import RESTServer

  app = RESTServer()
</code></pre>
<p>The application <code>app</code> above can now we passed to an appropriate event loop of
the <code>asyncio</code> library, for instance as</p>
<pre><code class="language-python">  if __name__ == &quot;__main__&quot;:
    loop = asyncio.get_event_loop()
    loop.create_task(app.start())
    loop.run_forever()
</code></pre>
<p>Putting the above together, a minimal main loop looks something like</p>
<pre><code class="language-python">  # Import the Asynchronous IO Library
  try:
    import uasyncio as asyncio
  except ImportError:
    import asyncio

    from urest.http import RESTServer

    app = RESTServer()

    if __name__ == &quot;__main__&quot;:
      loop = asyncio.get_event_loop()
      loop.create_task(app.start())
      loop.run_forever()
</code></pre>
<p>An example of a small application which uses the above pattern can be found in the <em>Examples</em> section as <code><a title="urest.examples.led_control" href="examples/led_control.html">urest.examples.led_control</a></code></p>
<h2 id="licence">Licence</h2>
<p>This module, and all included code, is made available under the terms of the MIT
Licence</p>
<blockquote>
<p>Copyright 2022-2023, David Love</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
the Software, and to permit persons to whom the Software is furnished to do so,
subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
</blockquote>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;Micro REST-Style API Server.

Background
----------

This library is designed to enable simple API&#39;s to be built on
micro-controllers, based on a sub-set of the REST API design principles, and
inspired by the design of the [Apollo
DSKY](https://history-computer.com/apollo-guidance-computer/) guidance computer.
Rather than build a full HTTP server stack, including JSON parser, and
supporting the full complexity of modern REST API&#39;s, this library aims to
support simple operations in a resource constrained environment.

Like the DSKY unit, it is assumed that all the &#39;objects&#39; representing the states
we are interested in are held in &#39;nouns&#39; (implemented by the
`urest.api.base.APIBase` class). The HTTP actions then represent &#39;verbs&#39; which
dictate the actions on the noun. So each API call is then in the form of
&#39;verb-noun&#39;; e.g. &#39;GET /led&#39;, or &#39;PUT /led&#39;. Valid verb actions are

| Verb   | HTTP Method | Action                                                                                                                                                            |
|--------|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Get    | `GET`       | Return the current state of the requested noun.                                                                                                                   |
| Set    | `PUT`       | Set the requested noun to *exactly* the specified state. This is assumed to be idempotent, with the resultant state matching exactly the request from the client. |
| Update | `POST`      | Update the state requested noun. This is *not* assumed to be idempotent: for instance asking a noun to move between two states on each update.                    |
| Delete | `DELETE`    | Remove the current state of the noun, and return to a the default state. This does *not* remove the noun from the API: only the state currently held by the API.  |

In all cases the body of the HTTP request is a simple collection of &#39;key: value&#39;
pairs, formatted as a [JSON](https://www.json.org/json-en.html) object. Only a
sub-set of the JSON specification is used: in particular multiple objects are
not allowed, and nor are arrays (i.e. &#39;`[]`&#39;) of any sort. This both simplifies
the parsing, and especially the memory required for the parser, and reinforces
the intent to support only minimal API&#39;s.

Design
------

The core of the library is a simple HTTP server, specialised to the delivery of
a REST-like API instead of a general HTTP server. The design, and the use of the
`asyncio` library, is inspired by the [MicroPython HTTP
Server](https://github.com/erikdelange/MicroPython-HTTP-Server) by Erik de
Lange. This library uses a roughly similar structure for the core of the
`asyncio` event loop, and especially in the design of the
`urest.http.server.RESTServer` class.

Key differences include

*   Support for `PUT`, `POST` and `DELETE` operations, in addition to `GET`.
These are required for an API server, and also form the &#39;verbs&#39; of the actions
allowed on the &#39;nouns&#39; by the API built on-top of this library.

*   A more object-oriented design of the call/response handler, made easier this
library is *not* a general HTTP server. For instance Python `getters` and
`setters` are used where possible for input validation, and the central API
response is based on the `urest.api.base.APIBase` abstract base class

*   A more explicit validation of input from the network layer, especially in
the assumption that all input is by default hostile. This library should serve
as an example of best-practice in protocol handling; at least in the slightly
resource constrained environment of MicroPython

*   This implementation is principally a teaching library, so the
[Documentation](https://dlove24.github.io/urest/urest) should be at least as
important as the &#39;code&#39;. Where possible all algorithms and implementation
techniques should also be explained as fully as possible, or at least linked to
reference standards/implementations

*   For consistency, all code should also be in the format standardised by the
[Black](https://github.com/psf/black) library. This makes it easier to
co-ordinate external code and documentation with the implementation documented
here.

Example
-------

### Creating the Application `main` loop

This module assumes that the lower-level networking layers are already in place:
if you are using MicroPython that may mean additional work. You will also need a
copy of the `asyncio` library (or `uasyncio` in MicroPython. This can be
imported conditionally as

```python
   # Import the Asynchronous IO Library,
   # preferring the MicroPython library if
   # available
   try:
     import uasyncio as asyncio
   except ImportError:
    import asyncio
```

Once the network and asynchronous I/O library is available, create an instance
of the `urest.http.server.RESTServer` class from the `urest.http.server` module

```python
  from urest.http import RESTServer

  app = RESTServer()
```

The application `app` above can now we passed to an appropriate event loop of
the `asyncio` library, for instance as

```python
  if __name__ == &#34;__main__&#34;:
    loop = asyncio.get_event_loop()
    loop.create_task(app.start())
    loop.run_forever()
```

Putting the above together, a minimal main loop looks something like

```python
  # Import the Asynchronous IO Library
  try:
    import uasyncio as asyncio
  except ImportError:
    import asyncio

    from urest.http import RESTServer

    app = RESTServer()

    if __name__ == &#34;__main__&#34;:
      loop = asyncio.get_event_loop()
      loop.create_task(app.start())
      loop.run_forever()
```

An example of a small application which uses the above pattern can be found in the _Examples_ section as `urest.examples.led_control`

Licence
-------

This module, and all included code, is made available under the terms of the MIT
Licence

&gt; Copyright 2022-2023, David Love

&gt; Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the &#34;Software&#34;), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
the Software, and to permit persons to whom the Software is furnished to do so,
subject to the following conditions:

&gt; The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

&gt; THE SOFTWARE IS PROVIDED &#34;AS IS&#34;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

&#34;&#34;&#34;</code></pre>
</details>
</section>
<section>
<h2 class="section-title" id="header-submodules">Sub-modules</h2>
<dl>
<dt><code class="name"><a title="urest.api" href="api/index.html">urest.api</a></code></dt>
<dd>
<div class="desc"><p>Abstract base class and helper classes for the server-provided REST API …</p></div>
</dd>
<dt><code class="name"><a title="urest.examples" href="examples/index.html">urest.examples</a></code></dt>
<dd>
<div class="desc"><p>Examples of the module use, both as simple applications and as helper classes
for reuse in more complete applications …</p></div>
</dd>
<dt><code class="name"><a title="urest.http" href="http/index.html">urest.http</a></code></dt>
<dd>
<div class="desc"><p>Network interface and helper classes for abstracting the underlying HTTP stream …</p></div>
</dd>
</dl>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul>
<li><a href="#background">Background</a></li>
<li><a href="#design">Design</a></li>
<li><a href="#example">Example</a><ul>
<li><a href="#creating-the-application-main-loop">Creating the Application main loop</a></li>
</ul>
</li>
<li><a href="#licence">Licence</a></li>
</ul>
</div>
<ul id="index">
<li><h3><a href="#header-submodules">Sub-modules</a></h3>
<ul>
<li><code><a title="urest.api" href="api/index.html">urest.api</a></code></li>
<li><code><a title="urest.examples" href="examples/index.html">urest.examples</a></code></li>
<li><code><a title="urest.http" href="http/index.html">urest.http</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>